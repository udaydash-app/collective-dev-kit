# Windows Auto-Update - Quick Setup Guide

## âœ… What's Already Done

Your Windows app now has auto-update functionality built-in! Here's what happens:

1. **On App Launch**: Checks for updates automatically after 3 seconds
2. **Update Available**: Shows a dialog asking if user wants to download
3. **Download**: Progress is logged in console
4. **Install**: After download, asks user to restart to install

## ðŸš€ Setup Steps (One-Time)

### Step 1: Connect to GitHub (5 minutes)

1. Open your Lovable project
2. Click the **GitHub button** (top-right corner)
3. Click "Connect to GitHub"
4. Authorize Lovable
5. Create a repository (note the name!)

### Step 2: Update Configuration (2 minutes)

1. Open `electron-builder.json`
2. Find these lines at the bottom:
```json
"publish": {
  "provider": "github",
  "owner": "YOUR_GITHUB_USERNAME",    â† Change this
  "repo": "YOUR_REPO_NAME"            â† Change this
}
```

3. Replace with your actual GitHub username and repository name

**Example:**
```json
"publish": {
  "provider": "github",
  "owner": "johnsmith",
  "repo": "global-market-pos"
}
```

### Step 3: Create Your First Release (10 minutes)

**On your Windows development machine:**

```bash
# 1. Make sure you're in the project folder
cd C:\collective-dev-kit

# 2. Set version (this creates v1.0.0)
npm version 1.0.0

# 3. Build the installer
npm run build
npm run electron:build

# 4. Push to GitHub with the version tag
git add .
git commit -m "Add auto-update support"
git push origin main
git push origin v1.0.0
```

### Step 4: Upload to GitHub Releases

1. Go to your GitHub repository
2. Click "Releases" (right sidebar)
3. Click "Create a new release"
4. Choose tag: `v1.0.0`
5. Upload these files from `C:\collective-dev-kit\release\`:
   - `Global Market POS-1.0.0-x64.exe`
   - `latest.yml` (auto-generated by electron-builder)
6. Click "Publish release"

**âœ… Done!** Your first release is live and ready for updates!

## ðŸ“¦ Publishing Future Updates

After you make changes and want to release an update:

### Automatic Way (Recommended - uses GitHub Actions)

```bash
# 1. Update version
npm version patch    # 1.0.0 â†’ 1.0.1
# OR
npm version minor    # 1.0.0 â†’ 1.1.0

# 2. Push the tag
git push origin main
git push origin --tags
```

The **GitHub Action** (already created in `.github/workflows/build-windows.yml`) will:
- Build the Windows installer automatically
- Create a GitHub release
- Upload the installer

### Manual Way

```bash
# 1. Build locally
npm version patch
npm run build
npm run electron:build

# 2. Create GitHub release manually
# Upload files from release/ folder
```

## ðŸŽ¯ How Users Experience Updates

### First Install (v1.0.0)
- User downloads `Global Market POS-1.0.0-x64.exe` from your website
- Installs normally
- App is now version 1.0.0

### Getting Update to v1.0.1
1. User opens the app (v1.0.0)
2. After 3 seconds, a dialog appears:
   ```
   ðŸ“¦ Update Available
   A new version 1.0.1 is available.
   Do you want to download it now?
   
   [Download]  [Later]
   ```
3. User clicks **Download**
4. Download happens in background
5. When complete, another dialog:
   ```
   âœ… Update Ready
   Update downloaded. The application will restart to install.
   
   [Restart Now]  [Later]
   ```
6. User clicks **Restart Now**
7. App closes, installs update, and reopens
8. **Done!** Now running v1.0.1

## ðŸ”§ Testing Updates Locally

To test if auto-update works:

### Test Setup
1. Build and install v1.0.0 on your machine
2. Create v1.0.1 and publish to GitHub
3. Open the installed app (still v1.0.0)
4. Wait ~3 seconds
5. You should see "Update Available" dialog!

### If Testing Doesn't Work
- Make sure app version (package.json) is LOWER than release version
- Check GitHub release is public (not draft)
- Verify `latest.yml` exists in GitHub release
- Check console logs in app for error messages

## ðŸ’¡ Adding "Check for Updates" Button (Optional)

Want to add a manual update check button? Add this to your settings page:

```typescript
// In your React component
const checkForUpdates = async () => {
  if (window.electron?.checkForUpdates) {
    const result = await window.electron.checkForUpdates();
    if (result.success) {
      // Update check initiated
      toast.success("Checking for updates...");
    } else {
      toast.error(result.error || "Failed to check for updates");
    }
  }
};

// In your JSX
<Button onClick={checkForUpdates}>
  Check for Updates
</Button>
```

## ðŸ’° Cost

- **GitHub Releases**: FREE âœ…
- **GitHub Actions**: FREE for public repos, generous limits for private
- **No CDN or hosting fees**: Everything uses GitHub's infrastructure

## ðŸ›Ÿ Troubleshooting

### "Update check failed"
- **Solution**: Check internet connection, verify GitHub repo is accessible

### "No updates available" but new version exists
- **Check**: Is the app version in package.json lower than the release version?
- **Check**: Is the GitHub release published (not draft)?
- **Check**: Does `latest.yml` exist in the release?

### Update downloads but doesn't install
- **Check**: Is NSIS installer used? (yes, it is in config)
- **Check**: Does user have admin rights on Windows?

### GitHub Action build fails
- **Check**: GitHub token permissions
- **Check**: All dependencies installed (npm install succeeded?)
- **Try**: Re-run the workflow

## ðŸ“‹ Summary

### What You Did
âœ… Installed electron-updater  
âœ… Configured auto-update in electron/main.cjs  
âœ… Added update checks on app startup  
âœ… Set up GitHub as update server  
âœ… Created GitHub Action for automatic builds  

### What Happens Now
- App automatically checks for updates on launch
- Users get notified and can update with 2 clicks
- No more manual uninstall/reinstall! ðŸŽ‰

### Your Update Workflow
1. Make code changes in Lovable
2. Run: `npm version patch && git push origin --tags`
3. GitHub Action builds and publishes automatically
4. Users get the update next time they open the app

**That's it!** Your Windows app now updates like a professional application. ðŸš€
